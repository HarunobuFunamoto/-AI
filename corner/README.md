# corner
- 作成者：Funamoto
- リリース日：2018.7.11
- 更新日：2018.7.11

# 概要
1. imageから画像を読み込み、画像を任意の縦横のピクセルにリサイズし、new_imageに保存（リサイズしたくなければ１は飛ばしても良い）
2. labelImgというフリーソフトを用いて、１でリサイズした画像の頂点をメモする。labelImgではマウスポインタの座標がわかるので、それを利用して４つの頂点の座標をメモする。
3. new_imageのディレクトリにある画像をランダムに回転、平行移動、縮小する。
4. ２でメモした頂点の座標を打ち込み、1に対応するように、頂点の四つの座標も移動させる。
5. 3と4を学習用とテスト用に分ける。
6. ５の学習用画像データと頂点座標のラベルを使ってCNNで学習。
7. ５のテスト用画像データを使って、それぞれの頂点座標を予測する。


# 動作環境
- Python 3.6.5
- OpenCV 3.4.0
- numpy 1.14.2


# ディレクトリ構成内容の説明
- `README.md`：このファイルです
- `resize_image.py`：概要の１を実行するファイル。
- `image`：resize_image.pyでリサイズする前の元の画像が入っている。
- `new_images`：resize_image.pyでリサイズし終えた画像が保存されるディレクトリ。
- `labelImg`：概要の２を実行するファイル。マウスポインタのx座標とy座標が画面右下にピクセルで表示されるので、頂点にポインタを合わせて座標をメモする。
- `cre_image_label.py`：概要3,4,5を実行するファイル。変形した画像とそれに対応する座標を生成するプログラム。座標は当プログラム内のimage_point関数の引数に入力する。座標はピクセルで引数に入力し、座標を出力する際は画像の縦、横に対する％で表される。なお、image_point関数はcnn_corner.pyの中で実行される。
- `cnn_corner.py`：概要6,7を実行するファイル。cre_image_label.pyのimage_point関数を実行し、CNNで座標の学習、予測を行う。座標はimage_point関数で処理され％で出力されたものを、CNNに学習する。予測も％で出力されるため、プログラムの最後で座標をピクセルに戻して表示する処理を行なっている。



# 環境の構築

次のコマンドによって必要環境を構築できる。
```
まず作業フォルダに移動します
$ cd corner

OpenCVのインストール
$ pip install opencv-contrib-python

numpyのインストール
$ pip install numpy

kerasのインストール
$ pip install keras==2.0.5

scikit-learnのインストール
$ pip install scikit-learn

```


# 実行


```
作業ディレクトリへ移動する
$ cd corner


概要１のリサイズを実行。（特にリサイズをしたくなければ実行しなくても良い）
例：縦200ピクセル、横300ピクセルにリサイズする コマンド上でサイズ指定する。
$ python resize_image.py 200 300


概要２のlabelImgの起動方法
$ cd labelImg
$ python labelImg.py
マウスポインタを画像の上に載せると、画面右下に座標がピクセル単位で表示されるのでそれをメモする


パラメータをセッティングし、残り全ての処理を実行する（画像・座標生成、学習、予測）
$ python cnn_corner.py
```



# パラメーターの設定

## CNNのパラメータセッティング（cnn_corner.py内で設定）

```
バッチサイズ
batch_size = ...

エポック数
epoch = ...
```

## image_point関数の引数セッティング（cnn_corner.py内で設定）
```
生成する画像の数
num_image = ...

以下の範囲内でランダムに画像を縮小、回転、平行移動。
画像を縮小するときの最小ピクセル
size_min = ...
画像を回転させる時の最大角度
ang_max = ...
平行移動させる最大の距離（ピクセルで指定）
tate = ...
yoko = ...

メモした画像の頂点の座標を記入する　ピクセルで記入
x1　左上のx座標
y1　左上のy座標
x2　左下のx座標
y2　左下のy座標
x3　右上のx座標
y3　右上のy座標
x4　右下のx座標
y4　右下のy座標
```



# 更新履歴
2018.7.11 - リリース
