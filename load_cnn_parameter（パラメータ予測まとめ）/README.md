# load_cnn_parameter
- 作成者：Funamoto
- リリース日：2018.6.28
- 更新日：2018.6.28


# 概要
1. 学習させたい画像を入れるimageディレクトリから、画像をランダムに回転、平行移動、拡大、縮小する。その画像を学習用とテスト用に分けて、各パラメーター＝ラベルと共にdataディレクトリに保存　(FTS_images.pyの内容)
2. 1の画像とラベルを入力し、回転、平行移動、拡大、縮小それぞれのパラメーターを予測。学習した重みとモデルはcnnファイルに保存。　(cnn_para_predict.pyの内容)
3. 予測したい画像を格納するpre_imageディレクトリから、画像をランダムに回転、平行移動、拡大、縮小する。それぞれのパラメーター＝ラベルも用意。　(gene_pre_img.pyの内容)
4. 3の画像とラベルを入力し、2で保存した重みとモデルを使ってパラメーター予測を行う。　(load_predict.pyの内容)


# 動作環境
- Python 3.6.5
- OpenCV 3.4.0
- numpy 1.14.2
- Keras 2.0.5


# ディレクトリ構成内容の説明
- `README.md`：このファイルです
- `FTS_images.py`：概要の１を実行するファイル。自動的に学習用とテスト用に振り分けてくれる。cnn_para_predict.pyの中で関数として実行する。
- `cnn_para_predict.py`：概要の２を実行するファイル。１回の学習でパラメーター４つ予測する。モデルと重みはcnnディレクトリに保存される。
- `gene_pre_img.py`：概要の３を実行するファイル。予測させたい画像の回転、拡大、縮小、平行移動を行う。load_predict.pyの中で関数として実行する。
- `load_predict.py`：概要の４を実行するファイル。gene_pre_img.pyで作った新しい画像に対して、保存済みのモデルと重みでパラメーター４つ予測する。
- `image`：概要１で処理する前の元の画像が入っている。学習で使う画像はここに。
- `data`：概要１で処理し終えた画像データとラベルのデータが保存されるディレクトリ。
- `pre_image`：概要３で処理する前の元の画像が入っている。予測したい画像はここに。
- `cnn`：概要２で保存された重みとモデルが格納されるディレクトリ



# 環境の構築

次のコマンドによって必要環境を構築できる。
```
まず作業フォルダに移動します
$ cd load_cnn_parameter

OpenCVのインストール
$ pip install opencv-contrib-python

numpyのインストール
$ pip install numpy

kerasのインストール
$ pip install keras==2.0.5

scikit-learnのインストール
$ pip install scikit-learn

```


# 実行


```
作業ディレクトリへ移動する
$ cd CNN_parameter_predict

学習を行いパラメーター予測（概要１、２）
$ python cnn_para_predict.py

実行後の生成画像やラベルは次のディレクトリに生成される
$ cd data

保存したモデルと重みを使って、パラメーター予測（概要３、４）
この時に実行ファイルの後ろに予測で使いたい重みのファイル名を記入する
$ python load_predict.py CNN_.07-18110.29.hdf5


```



# cnn_para_predict.pyのパラメーターの設定

## CNNのパラメータセッティング

```
バッチサイズ
batch_size = ...

エポック数
epoch = ...
```

## 以下はランダムに画像を生成するときのパラメーターセッティングで、FTS_images.pyのgenerate_images関数の引数セッティング。
```
生成する画像の数
num_image = ...

生成する画像の一辺のサイズ（正方形を想定）
image_size = ...　


以下の範囲内でランダムに画像を拡大、縮小、回転。

画像を縮小するときの最小ピクセル
size_min = ...
画像を拡大するときの最大ピクセル
size_max = ...
画像を回転させる時の最大角度
ang_max = ...
```



# load_predict.pyのパラメーターの設定
```
使用する重みのファイル名　コマンド上で指定する
filename = ...

使用するモデルのファイル名　作られるモデルは一つだけなので、特に変える必要はないと思われる
modelname = ...
```

## 以下はgene_pre_img.pyのgen_images関数の引数のセッティング
```
画像一枚につき何枚画像を回転や移動などして画像を生成するか
num_image　= ...

生成する画像の一辺のサイズ（正方形を想定）
image_size　= ...

以下の範囲内でランダムに画像を拡大、縮小。
画像を縮小するときの最小%
size_min　= ...

画像を拡大するときの最大%
size_max　= ...

画像を回転させる時の最大角度
ang_max　= ...

縦方向への最大移動距離　ピクセルで指定
tate = ...

横方向への最大移動距離　ピクセルで指定
yoko = ...

リサイズする縦横　ピクセルで指定　概要１と同じサイズにする
縦：row = 280
横：col = 180
```






# 更新履歴
2018.6.28 - リリース
